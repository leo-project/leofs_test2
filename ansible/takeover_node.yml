---

## Start LeoFS
- hosts: localhost
  gather_facts: False
  name: Config Admin Tool
  roles:
      - { role: controller }

- hosts: localhost
  gather_facts: False
  tasks:
      - name: Detach Node
        command: ./leofs-adm detach {{ takeover_node }}

- hosts: leo_storage_stop
  name: Stop LeoStorages
  roles:
      - { role: leo_storage, control_leofs: "stop" }

- hosts: leo_storage_start
  name: Start LeoStorages
  roles:
      - { role: leo_storage, control_leofs: "start" }

- hosts: localhost
  gather_facts: False
  tasks:
    - name: Wait for LeoStorages
      pause: seconds=30

- hosts: localhost
  gather_facts: False
  tasks:
      - name: Rebalance Node
        command: ./leofs-adm rebalance
